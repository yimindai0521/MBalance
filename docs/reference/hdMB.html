<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>High-Dimensional Mahalanobis balancing — hdMB • MBalance</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="High-Dimensional Mahalanobis balancing — hdMB"><meta property="og:description" content="High-Dimensional Mahalanobis balancing is a multivariate
perspective of approximate covariate balancing method to estimate average
treatment effect in causal inference. We use function hdMB to select variable then
Mahalanobis balancing method will be applied to estimate ATE."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MBalance</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/package_intro.html">An Brief Introduction to `MBalance`</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>High-Dimensional Mahalanobis balancing</h1>
    
    <div class="hidden name"><code>hdMB.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>High-Dimensional Mahalanobis balancing is a multivariate
perspective of approximate covariate balancing method to estimate average
treatment effect in causal inference. We use function <code>hdMB</code> to select variable then
Mahalanobis balancing method will be applied to estimate ATE.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">hdMB</span><span class="op">(</span>
  <span class="va">x</span>,
  <span class="va">treat</span>,
  <span class="va">group1</span>,
  group2 <span class="op">=</span> <span class="cn">NA</span>,
  <span class="va">outcome</span>,
  method <span class="op">=</span> <span class="st">"MB"</span>,
  delta.space <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.01</span>, <span class="fl">0.001</span>, <span class="fl">1e-04</span>, <span class="fl">1e-05</span>, <span class="fl">1e-06</span><span class="op">)</span>,
  GASMD.bound <span class="op">=</span> <span class="fl">0.1</span>,
  iterations <span class="op">=</span> <span class="fl">1000</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>covariates.</p></dd>
<dt>treat</dt>
<dd><p>treatment indicator vector.</p></dd>
<dt>group1</dt>
<dd><p>see Details.</p></dd>
<dt>group2</dt>
<dd><p>see Details, Default: NA.</p></dd>
<dt>outcome</dt>
<dd><p>outcome vector.</p></dd>
<dt>method</dt>
<dd><p>a string that takes values in "MB", "MB2", See Details, Default: 'MB'.</p></dd>
<dt>delta.space</dt>
<dd><p>a vector of candidate values for tuning parameter, See Details,
Default: c(1e-1, 1e-2, 1e-3, 1e-4, 1e-5, 1e-6).</p></dd>
<dt>GASMD.bound</dt>
<dd><p>An upper bound for choosing the variables, See Details, Default: 0.1.</p></dd>
<dt>iterations</dt>
<dd><p>iteration times in optimization problem, Default: 1000.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>a hdMB object with the following attributes:</p><ul><li><p>GMIM: Generalized Multivariate Imbalance Measure that defines in our paper.</p></li>
<li><p>GASMD: Generalized Absolute Standardized Mean Difference, See Details.</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>group1</code>,<code>group2</code></p><ul><li><p>To estimate \(E(Y (1))\) (average treatment effect for group 1),
you need to set <code>group1</code> = 1 and ignore <code>group2</code>. Similarly,
To estimate \(E(Y (0))\) (average treatment effect for group 0),
you need to set <code>group1</code> = 0 and ignore <code>group2</code>.</p></li>
<li><p>To estimate average treatment effect on the control group \(E(Y (1) | T = 0)\),
you need to set <code>group1</code> = 1 and <code>group2</code> = 0. Similarly, To estimate
average treatment effect on the treated group \(E(Y (0) | T = 1)\),
you need to set <code>group1</code> = 0 and <code>group2</code> = 1.</p></li>
<li><p>This function is feasible when there are more than two groups.</p></li>
</ul><p><code>method</code> can be a valid string, including</p><ul><li><p>"MB": We choose the weighting matrix \({W}_1=[diag(\hat{\Sigma})]^{-1}\)
where \(\hat{\Sigma}\) denotes sample covariance matrix.</p></li>
<li><p>"MB2": We choose the weighting matrix \({W}_2={[\hat{\Sigma}]^{-1}}\)
where \(\hat{\Sigma}\) denotes sample covariance matrix.</p></li>
</ul><p><code>delta.space</code> grid of values for the tuning parameter, a vector of
candidate values for the degree of approximate covariate balance. The default
is c(1e-1, 1e-2, 1e-3, 1e-4, 1e-5, 1e-6).</p>
<p><code>GASMD.bound</code> GASMD is an imbalance measure. We first standardize our covariate,
then \(GASMD_{a,k} = (X_{1,a,k} + ... + X_{n_a,a,k}) / n_a - mean_k\) where \(X_{a}\) denotes
the covariate in group a, k denotes the k-th dimension of covariate and \(n_a\) denotes the
sample size in group a. Note that GASMD is different from ASMD. In our paper, we suggest
using ASMD to select the variable. However, when there are more than two groups,
ASMD is unsuitable. Therefore, we use GASMD instead of ASMD to select the variable.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">#hdMB</span></span>
<span class="r-in"><span class="co">##generating high-dimensional data</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">0521</span><span class="op">)</span></span>
<span class="r-in"><span class="va">data</span>        <span class="op">&lt;-</span> <span class="fu"><a href="si.data.html">si.data</a></span><span class="op">(</span>sample.size <span class="op">=</span> <span class="fl">200</span>, dimension <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span class="r-in"><span class="va">dimension</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">##estimating ATE##</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">##choosing variable</span></span>
<span class="r-in"><span class="va">hdMB1</span>       <span class="op">&lt;-</span> <span class="fu">hdMB</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, method <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">hdMB1</span><span class="op">$</span><span class="va">GMIM</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 1.009530e-09 4.698532e-10 3.585731e-10 2.898017e-10 2.963972e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] 2.269770e-10 2.413735e-10 2.523061e-10 3.074013e-10 3.062586e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] 3.201180e-10 3.637801e-10 2.527609e-10 2.591048e-10 2.972363e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] 2.529676e-10 2.404731e-10 8.236534e-10 4.254837e-10 9.506346e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] 8.240780e-10 8.803717e-10 1.090486e-09 9.836493e-10 9.581269e-07</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 1.576464e-05</span>
<span class="r-in"><span class="va">threshold</span>   <span class="op">&lt;-</span> <span class="fl">24</span></span>
<span class="r-in"><span class="va">index1</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">hdMB1</span><span class="op">$</span><span class="va">GASMD</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="va">dimension</span> <span class="op">-</span> <span class="va">threshold</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">##choosing variable</span></span>
<span class="r-in"><span class="va">hdMB2</span>       <span class="op">&lt;-</span> <span class="fu">hdMB</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, method <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">hdMB2</span><span class="op">$</span><span class="va">GMIM</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 1.013443e-09 4.165684e-10 3.060022e-10 2.989469e-10 2.019793e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] 1.836889e-10 1.823804e-10 1.657426e-10 1.582662e-10 1.827693e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] 1.591133e-10 1.009574e-09 1.278928e-10 1.237531e-10 1.254830e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] 1.164060e-10 1.129730e-10 1.461194e-10 1.420197e-10 1.815353e-10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] 2.493475e-10 2.207225e-10 5.923506e-10 4.494290e-10 3.734073e-10</span>
<span class="r-in"><span class="va">threshold</span>   <span class="op">&lt;-</span> <span class="fl">25</span></span>
<span class="r-in"><span class="va">index2</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">hdMB2</span><span class="op">$</span><span class="va">GASMD</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="va">dimension</span> <span class="op">-</span> <span class="va">threshold</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">##an estimate of ATE</span></span>
<span class="r-in"><span class="va">result1</span>     <span class="op">&lt;-</span> <span class="fu"><a href="MB.html">MB</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="va">index1</span><span class="op">]</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span class="r-in"><span class="va">result2</span>     <span class="op">&lt;-</span> <span class="fu"><a href="MB.html">MB</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="va">index2</span><span class="op">]</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span class="r-in"><span class="va">result1</span><span class="op">$</span><span class="va">AT</span> <span class="op">-</span> <span class="va">result2</span><span class="op">$</span><span class="va">AT</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.466609</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">##estimating ATC##</span></span>
<span class="r-in"><span class="va">hdMB3</span>       <span class="op">&lt;-</span> <span class="fu">hdMB</span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, group2 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span>, method <span class="op">=</span> <span class="st">"MB"</span><span class="op">)</span></span>
<span class="r-in"><span class="va">hdMB3</span><span class="op">$</span><span class="va">GMIM</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 1.212616e-09 3.168743e-09 4.198361e-09 1.023991e-09 1.176201e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6] 4.389520e-09 4.859900e-09 3.890700e-04 6.189813e-03 6.180703e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11] 7.681887e-03 7.083583e-03 1.239884e-02 1.377881e-02 1.402955e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16] 1.302385e-02 1.343482e-02 2.059218e-02 2.117580e-02 2.557701e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] 2.467458e-02 2.760436e-02 2.801698e-02 2.695449e-02 2.584830e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [26] 2.602368e-02 2.610590e-02 2.627600e-02 2.534782e-02 2.792964e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] 2.809770e-02 3.014364e-02 3.033542e-02 3.028159e-02 2.969784e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [36] 3.086814e-02 3.078667e-02 2.996725e-02 2.919587e-02 2.908196e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [41] 2.835851e-02 2.828126e-02 2.793579e-02 2.727435e-02 2.668795e-02</span>
<span class="r-in"><span class="va">threshold</span>   <span class="op">&lt;-</span> <span class="fl">7</span></span>
<span class="r-in"><span class="va">index3</span>      <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">hdMB3</span><span class="op">$</span><span class="va">GASMD</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="op">(</span><span class="va">dimension</span> <span class="op">-</span> <span class="va">threshold</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="va">result3</span>     <span class="op">&lt;-</span> <span class="fu"><a href="MB.html">MB</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="va">index3</span><span class="op">]</span>, treat <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Tr</span>, group1 <span class="op">=</span> <span class="fl">1</span>, group2 <span class="op">=</span> <span class="fl">0</span>, outcome <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">##an estimate of ATC</span></span>
<span class="r-in"><span class="va">result3</span><span class="op">$</span><span class="va">AT</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span><span class="va">data</span><span class="op">$</span><span class="va">Tr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 2.005467</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Yimin Dai.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

